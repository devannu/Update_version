<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QR Scanner - Visitor Management System</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        .fade { animation: fadeIn .5s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to   { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>

<body class="bg-[#e8efff] min-h-screen flex flex-col pt-24 px-4">

<!-- NAVBAR -->
<nav class="w-full bg-[#234997] text-white px-6 py-4 rounded-xl 
            fixed top-0 left-0 flex justify-between items-center shadow-lg z-50 fade">

    <h1 class="text-lg md:text-3xl font-semibold tracking-wide">
        Visitor Management System
    </h1>

    <!-- Desktop Menu -->
    <ul class="hidden md:flex gap-6 text-lg font-medium">
        <li><a href="index.html" class="hover:text-gray-300">Home</a></li>
        <li><a href="visitor_form.html" class="hover:text-gray-300">New Visitor</a></li>
        <li><a href="QR.html" class="hover:text-gray-300">QR Scan</a></li>
        <li><a href="About.html" class="hover:text-gray-300">About Us</a></li>
        <li><a href="help.html" class="hover:text-gray-300">Help</a></li>
    </ul>

    <!-- Mobile Toggle -->
    <button onclick="toggleMenu()" class="md:hidden text-3xl">☰</button>
</nav>

<!-- Mobile Dropdown -->
<div id="mobileMenu"
     class="hidden bg-[#234997] text-white backdrop-blur-md mx-4 mt-24 p-4 rounded-xl md:hidden fade text-center">

    <ul class="flex flex-col gap-4 text-lg">
        <li><a href="index.html" class="hover:text-gray-300">Home</a></li>
        <li><a href="visitor_form.html" class="hover:text-gray-300">New Visitor</a></li>
        <li><a href="QR.html" class="hover:text-gray-300">QR Scan</a></li>
        <li><a href="About.html" class="hover:text-gray-300">About Us</a></li>
        <li><a href="help.html" class="hover:text-gray-300">Help</a></li>
    </ul>
</div>

<script>
function toggleMenu() {
    document.getElementById("mobileMenu").classList.toggle("hidden");
}
</script>

<!-- MAIN CONTENT -->
<div class="max-w-lg mx-auto mt-10 bg-white p-6 rounded-2xl shadow-xl text-center fade flex-grow">
    <h2 class="text-2xl font-bold text-[#234997] mb-4">Scan Visitor QR Code</h2>

    <p class="text-gray-700 mb-4">
        Hold the QR code in front of the camera to mark Entry/Exit automatically.
    </p>

    <div id="reader" class="mx-auto" style="width: 300px;"></div>

    <button onclick="startScanner()" 
            class="mt-6 bg-[#234997] hover:bg-[#1b3b7e] text-white px-5 py-3 rounded-lg shadow">
        Start Scanner
    </button>

    <p id="scan-status" class="mt-4 text-green-600 font-semibold"></p>
</div>

<!-- FOOTER -->
<footer class="w-full bg-[#234997] text-white py-5 mt-12 
        text-center rounded-t-2xl shadow-lg">
    <p class="text-sm sm:text-base tracking-wide">
        © 2025 Visitor Management System Project Team
    </p>
</footer>

<!-- Scripts -->
<script src="https://unpkg.com/html5-qrcode"></script>
<script src="script.js"></script>

<script>
let html5scanner = null;

// --------------------- START SCANNER -------------------------
function startScanner() {

    const status = document.getElementById("scan-status");
    status.innerHTML = "Starting camera...";

    // If scanner already running → stop first
    if (html5scanner !== null) {
        html5scanner.stop().catch(() => {});
    }

    html5scanner = new Html5Qrcode("reader");

    html5scanner.start(
        { facingMode: "environment" },
        {
            fps: 12,
            qrbox: { width: 230, height: 230 }
        },

        // --------------------- SUCCESS ---------------------
        (decodedText) => {
            html5scanner.pause(true); // Stop scanning frame
            status.innerHTML = "QR Scanned Successfully! Updating record...";

            try {
                let data = JSON.parse(decodedText);
                updateVisitorFromQR(data); // YOUR function
            } catch (err) {
                status.innerHTML = "Invalid QR Code!";
            }

            // SCAN AGAIN BUTTON
            status.innerHTML += `
                <br>
                <button onclick="restartScan()" 
                    class="mt-3 bg-blue-600 text-white px-4 py-2 rounded-lg">
                    Scan Again
                </button>`;
        },

        // --------------------- SCAN FAILED (ignore) ---------------------
        (error) => {}
    )
    .then(() => {
        status.innerHTML = "Camera Ready — Show QR";
    })
    .catch((err) => {
        status.innerHTML = "Unable to open camera!<br>Give permission and try again.";
    });
}

// --------------------- RESTART SCAN -------------------------
function restartScan() {
    const status = document.getElementById("scan-status");
    status.innerHTML = "Restarting...";

    if (html5scanner !== null) {
        html5scanner.stop().then(() => {
            html5scanner.clear();
            startScanner();
        });
    } else {
        startScanner();
    }
}
</script>


</body>
</html>
